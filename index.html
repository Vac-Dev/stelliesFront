<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Match Quiz</title>
    <link href="/dist/styles.css" rel="stylesheet" />
  </head>
  <body class="min-h-screen flex items-center justify-center bg-black p-4">
    <div class="w-full max-w-2xl bg-white text-black rounded-2xl shadow-lg p-6 space-y-6">
      <h1 class="text-3xl font-bold text-emerald-700 text-center">Find Your Next Read</h1>

      <!-- Questions -->
      <div id="quiz-container" class="space-y-6">
        <!-- Each question block will be inserted here -->
      </div>

      <button id="confirm" class="w-full py-3 bg-emerald-700 text-white font-semibold rounded-lg hover:bg-emerald-800 transition">
        Confirm & Get Recommendation
      </button>

      <div id="result" class="mt-6 p-4 bg-gray-100 rounded-lg hidden">
        <p class="text-gray-700 italic">Fetching recommendation…</p>
      </div>
    </div>

    <script>
      const questions = [
        {
          id: "q1",
          text: "1. What kind of story pace are you in the mood for?",
          options: [
            "Fast and plot-heavy",
            "Slow and emotional",
            "Balanced",
            "Light and easy",
            "Intense and thought-provoking",
          ],
        },
        {
          id: "q2",
          text: "2. What kind of world do you want to escape into?",
          options: [
            "Realistic and relatable",
            "Historical",
            "Magical or fantastical",
            "Futuristic or dystopian",
            "Small-town or community-based",
          ],
        },
        {
          id: "q3",
          text: "3. Pick a main character energy:",
          options: [
            "Soft but secretly powerful",
            "Brave but scared",
            "Smart with emotional damage",
            "Bubbly outside, overthinking inside",
            "Awkward but loveable",
          ],
        },
        {
          id: "q4",
          text: "4. What kind of story feels like a hug right now?",
          options: [
            "Cute and romantic",
            "Magical but gentle",
            "Quiet and heartfelt",
            "Fun and adventurous",
            "Reminds me I’m not alone",
          ],
        },
        {
          id: "q5",
          text: "5. Your book should feel like...",
          options: [
            "A soft lullaby",
            "A handwritten letter",
            "A sparkler on a summer night",
            "A deep breath after crying",
            "A playlist of your favourite songs",
          ],
        },
      ];

      const answers = {};
      const container = document.getElementById("quiz-container");

      questions.forEach(({ id, text, options }) => {
        const section = document.createElement("div");
        section.className = "space-y-2";
        section.innerHTML = `<p class="font-medium">${text}</p>`;

        const btnGroup = document.createElement("div");
        btnGroup.className = "grid grid-cols-1 gap-2";

        options.forEach((opt) => {
          const btn = document.createElement("button");
          btn.className =
            "option-btn btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-emerald-100 transition text-left";
          btn.dataset.q = id;
          btn.dataset.a = opt;
          btn.textContent = opt;

          btn.addEventListener("click", () => {
            answers[id] = opt;
            document
              .querySelectorAll(`[data-q="${id}"]`)
              .forEach((b) =>
                b.classList.remove("bg-emerald-200", "ring-2", "ring-emerald-500")
              );
            btn.classList.add("bg-emerald-200", "ring-2", "ring-emerald-500");
          });

          btnGroup.appendChild(btn);
        });

        section.appendChild(btnGroup);
        container.appendChild(section);
      });

      document.getElementById("confirm").addEventListener("click", async () => {
        const keys = ["q1", "q2", "q3", "q4", "q5"];
        if (!keys.every((k) => answers[k])) {
          alert("Please answer all questions!");
          return;
        }

        const resultDiv = document.getElementById("result");
        resultDiv.classList.remove("hidden");
        resultDiv.innerHTML =
          '<p class="text-gray-700 italic">Fetching recommendation…</p>';

        try {
          const res = await fetch("https://stelliebackend.fly.dev/api/book-recommendation", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              q1: answers.q1,
              q2: answers.q2,
              q3: answers.q3,
              q4: answers.q4,
              q5: answers.q5,
            }),
          });

          const data = await res.json();
          resultDiv.innerHTML = `
            <p class="font-semibold text-gray-800">We think you’ll love:</p>
            <p class="mt-2 text-lg text-emerald-700">“${data.title}”</p>
            <p class="mt-1 text-gray-700">by ${data.author}</p>
          `;
        } catch (err) {
          resultDiv.innerHTML = `<p class="text-red-600">Oops, something went wrong.</p>`;
          console.error(err);
        }
      });
    </script>
  </body>
</html>
